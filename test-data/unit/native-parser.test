[case testHello]
print("hello")
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(print)
      Args(
        StrExpr(hello)))))

[case testMemberExpr]
foo_bar.xyz2
[out]
MypyFile:1(
  ExpressionStmt:1(
    MemberExpr:1(
      NameExpr(foo_bar)
      xyz2)))

[case testTupleExpr]
("a", "b")
[out]
MypyFile:1(
  ExpressionStmt:1(
    TupleExpr:1(
      StrExpr(a)
      StrExpr(b))))

[case testOpExpr]
("x" + "y") * "z"
[out]
MypyFile:1(
  ExpressionStmt:1(
    OpExpr:1(
      *
      OpExpr:1(
        +
        StrExpr(x)
        StrExpr(y))
      StrExpr(z))))

[case testIntExpr]
(0, 1, 2, 203, 5345, 50123, 1234567890)
[out]
MypyFile:1(
  ExpressionStmt:1(
    TupleExpr:1(
      IntExpr(0)
      IntExpr(1)
      IntExpr(2)
      IntExpr(203)
      IntExpr(5345)
      IntExpr(50123)
      IntExpr(1234567890))))

[case testAssignmentStmt]
x = 1
a, b = c = 6
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    IntExpr(1))
  AssignmentStmt:2(
    Lvalues(
      TupleExpr:2(
        NameExpr(a)
        NameExpr(b))
      NameExpr(c))
    IntExpr(6)))

[case testOperatorAssignment]
x += 1
y -= 2
z *= 3
[out]
MypyFile:1(
  OperatorAssignmentStmt:1(
    +
    NameExpr(x)
    IntExpr(1))
  OperatorAssignmentStmt:2(
    -
    NameExpr(y)
    IntExpr(2))
  OperatorAssignmentStmt:3(
    *
    NameExpr(z)
    IntExpr(3)))

[case testIfStmt]
if x:
    y
if a:
    b
else:
    c
[out]
MypyFile:1(
  IfStmt:1(
    If(
      NameExpr(x))
    Then(
      ExpressionStmt:2(
        NameExpr(y))))
  IfStmt:3(
    If(
      NameExpr(a))
    Then(
      ExpressionStmt:4(
        NameExpr(b)))
    Else(
      ExpressionStmt:6(
        NameExpr(c)))))

[case testIfStmtElif]
if a:
    b
elif c:
    d
else:
    e
[out]
MypyFile:1(
  IfStmt:1(
    If(
      NameExpr(a))
    Then(
      ExpressionStmt:2(
        NameExpr(b)))
    If(
      NameExpr(c))
    Then(
      ExpressionStmt:4(
        NameExpr(d)))
    Else(
      ExpressionStmt:6(
        NameExpr(e)))))

[case testWhileStmt]
while a:
    b
while c:
    d
else:
    e
[out]
MypyFile:1(
  WhileStmt:1(
    NameExpr(a)
    Block:2(
      ExpressionStmt:2(
        NameExpr(b))))
  WhileStmt:3(
    NameExpr(c)
    Block:4(
      ExpressionStmt:4(
        NameExpr(d)))
    Else(
      ExpressionStmt:6(
        NameExpr(e)))))

[case testIndexExpr]
a[b]
[out]
MypyFile:1(
  ExpressionStmt:1(
    IndexExpr:1(
      NameExpr(a)
      NameExpr(b))))

[case testListAndSetExpr]
a = []
b = [1, 2]
c = {3}
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(a)
    ListExpr:1())
  AssignmentStmt:2(
    NameExpr(b)
    ListExpr:2(
      IntExpr(1)
      IntExpr(2)))
  AssignmentStmt:3(
    NameExpr(c)
    SetExpr:3(
      IntExpr(3))))

[case testBoolOpAnd]
a and b
a and b and c
[out]
MypyFile:1(
  ExpressionStmt:1(
    OpExpr:1(
      and
      NameExpr(a)
      NameExpr(b)))
  ExpressionStmt:2(
    OpExpr:2(
      and
      OpExpr:2(
        and
        NameExpr(a)
        NameExpr(b))
      NameExpr(c))))

[case testBoolOpOr]
x or y
1 or 2 or 3
[out]
MypyFile:1(
  ExpressionStmt:1(
    OpExpr:1(
      or
      NameExpr(x)
      NameExpr(y)))
  ExpressionStmt:2(
    OpExpr:2(
      or
      OpExpr:2(
        or
        IntExpr(1)
        IntExpr(2))
      IntExpr(3))))

[case testComparisonSimple]
a < b
x == y
[out]
MypyFile:1(
  ExpressionStmt:1(
    ComparisonExpr:1(
      <
      NameExpr(a)
      NameExpr(b)))
  ExpressionStmt:2(
    ComparisonExpr:2(
      ==
      NameExpr(x)
      NameExpr(y))))

[case testComparisonChained]
a < b < c
x == y != z
[out]
MypyFile:1(
  ExpressionStmt:1(
    ComparisonExpr:1(
      <
      <
      NameExpr(a)
      NameExpr(b)
      NameExpr(c)))
  ExpressionStmt:2(
    ComparisonExpr:2(
      ==
      !=
      NameExpr(x)
      NameExpr(y)
      NameExpr(z))))

[case testComparisonIsNotIn]
a is b
x is not y
z in w
q not in r
[out]
MypyFile:1(
  ExpressionStmt:1(
    ComparisonExpr:1(
      is
      NameExpr(a)
      NameExpr(b)))
  ExpressionStmt:2(
    ComparisonExpr:2(
      is not
      NameExpr(x)
      NameExpr(y)))
  ExpressionStmt:3(
    ComparisonExpr:3(
      in
      NameExpr(z)
      NameExpr(w)))
  ExpressionStmt:4(
    ComparisonExpr:4(
      not in
      NameExpr(q)
      NameExpr(r))))

[case testLiterals]
(None, True, False, ...)
[out]
MypyFile:1(
  ExpressionStmt:1(
    TupleExpr:1(
      NameExpr(None)
      NameExpr(True)
      NameExpr(False)
      Ellipsis)))

[case testSimpleFunction]
def foo():
    x = 1
[out]
MypyFile:1(
  FuncDef:1(
    foo
    Block:2(
      AssignmentStmt:2(
        NameExpr(x)
        IntExpr(1)))))

[case testFunctionWithArgs]
def add(x, y):
    return x + y
[out]
MypyFile:1(
  FuncDef:1(
    add
    Args(
      Var(x)
      Var(y))
    Block:2(
      ReturnStmt:2(
        OpExpr:2(
          +
          NameExpr(x)
          NameExpr(y))))))

[case testFunctionWithVarArgs]
def foo(*args):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    foo
    VarArg(
      Var(args))
    Block:2(
      PassStmt:2())))

[case testFunctionWithKwargs]
def bar(**kwargs):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    bar
    DictVarArg(
      Var(kwargs))
    Block:2(
      PassStmt:2())))

[case testFunctionWithKwOnly]
def baz(x, *, y):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    baz
    MaxPos(1)
    Args(
      Var(x)
      Var(y))
    Block:2(
      PassStmt:2())))

[case testFunctionWithAllArgKinds]
def complex_fn(a, b, *args, c, **kwargs):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    complex_fn
    MaxPos(2)
    Args(
      Var(a)
      Var(b)
      Var(c))
    VarArg(
      Var(args))
    DictVarArg(
      Var(kwargs))
    Block:2(
      PassStmt:2())))

[case testAsyncFunction]
async def async_foo():
    pass
[out]
MypyFile:1(
  FuncDef:1(
    async_foo
    Async
    Block:2(
      PassStmt:2())))

[case testFunctionWithDefaultArg]
def greet(name="World"):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    greet
    Args(
      default(
        Var(name)
        StrExpr(World)))
    Block:2(
      PassStmt:2())))

[case testFunctionWithMultipleDefaults]
def add(x=1, y=2):
    return x
[out]
MypyFile:1(
  FuncDef:1(
    add
    Args(
      default(
        Var(x)
        IntExpr(1))
      default(
        Var(y)
        IntExpr(2)))
    Block:2(
      ReturnStmt:2(
        NameExpr(x)))))

[case testFunctionMixedDefaultsAndRegular]
def func(a, b=5, c=10):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    func
    Args(
      Var(a)
      default(
        Var(b)
        IntExpr(5))
      default(
        Var(c)
        IntExpr(10)))
    Block:2(
      PassStmt:2())))

[case testFunctionWithKwOnlyDefault]
def func(*, x=42):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    func
    MaxPos(0)
    Args(
      default(
        Var(x)
        IntExpr(42)))
    Block:2(
      PassStmt:2())))

[case testCallWithKeywordArgs]
foo(x=1, y=2)
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(foo)
      Args()
      KwArgs(
        x
        IntExpr(1))
      KwArgs(
        y
        IntExpr(2)))))

[case testCallMixedPositionalAndKeyword]
bar(1, 2, x=3, y=4)
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(bar)
      Args(
        IntExpr(1)
        IntExpr(2))
      KwArgs(
        x
        IntExpr(3))
      KwArgs(
        y
        IntExpr(4)))))

[case testCallWithStarArgs]
f(1, *x, 2)
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(f)
      Args(
        IntExpr(1)
        NameExpr(x)
        IntExpr(2))
      VarArg)))

[case testCallWithDictStarArgs]
f(**x)
f(1, **y)
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(f)
      Args()
      DictVarArg(
        NameExpr(x))))
  ExpressionStmt:2(
    CallExpr:2(
      NameExpr(f)
      Args(
        IntExpr(1))
      DictVarArg(
        NameExpr(y)))))

[case testCallWithAllArgTypes]
f(1, *x, a=2, **y)
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(f)
      Args(
        IntExpr(1)
        NameExpr(x))
      VarArg
      KwArgs(
        a
        IntExpr(2))
      DictVarArg(
        NameExpr(y)))))

[case testSimpleClass]
class A:
    pass
[out]
MypyFile:1(
  ClassDef:1(
    A
    PassStmt:2()))

[case testClassWithMethod]
class Foo:
    def bar(self):
        return 1
[out]
MypyFile:1(
  ClassDef:1(
    Foo
    FuncDef:2(
      bar
      Args(
        Var(self))
      Block:3(
        ReturnStmt:3(
          IntExpr(1))))))

[case testClassWithSingleBase]
class A(B):
    pass
[out]
MypyFile:1(
  ClassDef:1(
    A
    BaseTypeExpr(
      NameExpr(B))
    PassStmt:2()))

[case testClassWithMultipleBases]
class Child(Base1, Base2):
    x = 1
[out]
MypyFile:1(
  ClassDef:1(
    Child
    BaseTypeExpr(
      NameExpr(Base1)
      NameExpr(Base2))
    AssignmentStmt:2(
      NameExpr(x)
      IntExpr(1))))

[case testFloatLiteral]
x = 3.14
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    FloatExpr(3.14)))

[case testUnaryExpressions]
-x
+y
~z
not w
[out]
MypyFile:1(
  ExpressionStmt:1(
    UnaryExpr:1(
      -
      NameExpr(x)))
  ExpressionStmt:2(
    UnaryExpr:2(
      +
      NameExpr(y)))
  ExpressionStmt:3(
    UnaryExpr:3(
      ~
      NameExpr(z)))
  ExpressionStmt:4(
    UnaryExpr:4(
      not
      NameExpr(w))))

[case testDictionaryExpression]
{}
{1:x}
[out]
MypyFile:1(
  ExpressionStmt:1(
    DictExpr:1())
  ExpressionStmt:2(
    DictExpr:2(
      IntExpr(1)
      NameExpr(x))))

[case testComplexLiteral]
1j
2.5j
[out]
MypyFile:1(
  ExpressionStmt:1(
    ComplexExpr(1j))
  ExpressionStmt:2(
    ComplexExpr(2.5j)))

[case testSlices]
x[1:2]
x[:1]
x[1:]
x[:]
[out]
MypyFile:1(
  ExpressionStmt:1(
    IndexExpr:1(
      NameExpr(x)
      SliceExpr:1(
        IntExpr(1)
        IntExpr(2))))
  ExpressionStmt:2(
    IndexExpr:2(
      NameExpr(x)
      SliceExpr:2(
        <empty>
        IntExpr(1))))
  ExpressionStmt:3(
    IndexExpr:3(
      NameExpr(x)
      SliceExpr:3(
        IntExpr(1)
        <empty>)))
  ExpressionStmt:4(
    IndexExpr:4(
      NameExpr(x)
      SliceExpr:4(
        <empty>
        <empty>))))

[case testSliceWithStride]
x[1:2:3]
x[1::2]
x[:1:2]
x[::2]
[out]
MypyFile:1(
  ExpressionStmt:1(
    IndexExpr:1(
      NameExpr(x)
      SliceExpr:1(
        IntExpr(1)
        IntExpr(2)
        IntExpr(3))))
  ExpressionStmt:2(
    IndexExpr:2(
      NameExpr(x)
      SliceExpr:2(
        IntExpr(1)
        <empty>
        IntExpr(2))))
  ExpressionStmt:3(
    IndexExpr:3(
      NameExpr(x)
      SliceExpr:3(
        <empty>
        IntExpr(1)
        IntExpr(2))))
  ExpressionStmt:4(
    IndexExpr:4(
      NameExpr(x)
      SliceExpr:4(
        <empty>
        <empty>
        IntExpr(2)))))

[case testFunctionSignature]
def f() -> int:
    pass
def g() -> None:
    pass
def h(x: foo.bar, y, z: x.y.z):
    pass
[out]
MypyFile:1(
  FuncDef:1(
    f
    def () -> int?
    Block:2(
      PassStmt:2()))
  FuncDef:3(
    g
    def () -> None?
    Block:4(
      PassStmt:4()))
  FuncDef:5(
    h
    Args(
      Var(x)
      Var(y)
      Var(z))
    def (x: foo.bar?, y: Any, z: x.y.z?) -> Any
    Block:6(
      PassStmt:6())))

[case testFunctionSignature2]
def f(x: a[b]) -> c.d[e.f.g[h], i]:
    pass
[out]
MypyFile:1(
  FuncDef:1(
    f
    Args(
      Var(x))
    def (x: a?[b?]) -> c.d?[e.f.g?[h?], i?]
    Block:2(
      PassStmt:2())))

[case testUnionTypes]
def f(x: int | str) -> bool | None:
    pass
[out]
MypyFile:1(
  FuncDef:1(
    f
    Args(
      Var(x))
    def (x: int? | str?) -> bool? | None?
    Block:2(
      PassStmt:2())))

[case testAnnotatedAssignment]
x: int
y: str = "hello"
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    TempNode:1(
      Any)
    int?)
  AssignmentStmt:2(
    NameExpr(y)
    StrExpr(hello)
    str?))

[case testImportStatements]
import x
import a, b
import y as z
[out]
MypyFile:1(
  Import:1(x)
  Import:2(a, b)
  Import:3(y : z))

[case testImportFromStatements]
from os import path
from sys import argv, exit
from typing import List as L
from . import foo
from .. import bar
from .pkg import baz
[out]
MypyFile:1(
  ImportFrom:1(os, [path])
  ImportFrom:2(sys, [argv, exit])
  ImportFrom:3(typing, [List : L])
  ImportFrom:4(., [foo])
  ImportFrom:5(.., [bar])
  ImportFrom:6(.pkg, [baz]))

[case testRaiseStatements]
raise
raise ValueError
raise ValueError("error message")
raise KeyError from e
[out]
MypyFile:1(
  RaiseStmt:1()
  RaiseStmt:2(
    NameExpr(ValueError))
  RaiseStmt:3(
    CallExpr:3(
      NameExpr(ValueError)
      Args(
        StrExpr(error message))))
  RaiseStmt:4(
    NameExpr(KeyError)
    NameExpr(e)))

[case testAssertStatements]
assert x
assert x == y
assert condition, "error message"
[out]
MypyFile:1(
  AssertStmt:1(
    NameExpr(x))
  AssertStmt:2(
    ComparisonExpr:2(
      ==
      NameExpr(x)
      NameExpr(y)))
  AssertStmt:3(
    NameExpr(condition)
    StrExpr(error message)))

[case testForStatements]
for x in items:
    pass
for i, j in pairs:
    x = 1
for y in range(10):
    break
else:
    continue
[out]
MypyFile:1(
  ForStmt:1(
    NameExpr(x)
    NameExpr(items)
    Block:2(
      PassStmt:2()))
  ForStmt:3(
    TupleExpr:3(
      NameExpr(i)
      NameExpr(j))
    NameExpr(pairs)
    Block:4(
      AssignmentStmt:4(
        NameExpr(x)
        IntExpr(1))))
  ForStmt:5(
    NameExpr(y)
    CallExpr:5(
      NameExpr(range)
      Args(
        IntExpr(10)))
    Block:6(
      BreakStmt:6())
    Else(
      ContinueStmt:8())))

[case testWithStatements]
with f:
    pass
with open("file") as f:
    x = 1
with a as x, b as y:
    break
[out]
MypyFile:1(
  WithStmt:1(
    Expr(
      NameExpr(f))
    Block:2(
      PassStmt:2()))
  WithStmt:3(
    Expr(
      CallExpr:3(
        NameExpr(open)
        Args(
          StrExpr(file))))
    Target(
      NameExpr(f))
    Block:4(
      AssignmentStmt:4(
        NameExpr(x)
        IntExpr(1))))
  WithStmt:5(
    Expr(
      NameExpr(a))
    Target(
      NameExpr(x))
    Expr(
      NameExpr(b))
    Target(
      NameExpr(y))
    Block:6(
      BreakStmt:6())))

[case testBreakAndContinue]
while True:
    break
while x:
    continue
while y:
    if z:
        break
    else:
        continue
[out]
MypyFile:1(
  WhileStmt:1(
    NameExpr(True)
    Block:2(
      BreakStmt:2()))
  WhileStmt:3(
    NameExpr(x)
    Block:4(
      ContinueStmt:4()))
  WhileStmt:5(
    NameExpr(y)
    Block:6(
      IfStmt:6(
        If(
          NameExpr(z))
        Then(
          BreakStmt:7())
        Else(
          ContinueStmt:9())))))

[case testGeneratorExpressions]
(x for x in items)
(x * 2 for x in range(10) if x > 5)
(x + y for x in range(3) for y in range(2))
[out]
MypyFile:1(
  ExpressionStmt:1(
    GeneratorExpr:1(
      NameExpr(x)
      NameExpr(x)
      NameExpr(items)))
  ExpressionStmt:2(
    GeneratorExpr:2(
      OpExpr:2(
        *
        NameExpr(x)
        IntExpr(2))
      NameExpr(x)
      CallExpr:2(
        NameExpr(range)
        Args(
          IntExpr(10)))
      ComparisonExpr:2(
        >
        NameExpr(x)
        IntExpr(5))))
  ExpressionStmt:3(
    GeneratorExpr:3(
      OpExpr:3(
        +
        NameExpr(x)
        NameExpr(y))
      NameExpr(x)
      NameExpr(y)
      CallExpr:3(
        NameExpr(range)
        Args(
          IntExpr(3)))
      CallExpr:3(
        NameExpr(range)
        Args(
          IntExpr(2))))))

[case testYieldExpressions]
def gen():
    yield
    yield 1
    yield from items
[out]
MypyFile:1(
  FuncDef:1(
    gen
    Block:2(
      ExpressionStmt:2(
        YieldExpr:2())
      ExpressionStmt:3(
        YieldExpr:3(
          IntExpr(1)))
      ExpressionStmt:4(
        YieldFromExpr:4(
          NameExpr(items))))))

[case testListAndSetComprehensions]
a = [x for x in items]
b = [x * 2 for x in range(10) if x > 5]
c = {y for y in data}
d = {z + 1 for z in nums if z < 100}
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(a)
    ListComprehension:1(
      GeneratorExpr:1(
        NameExpr(x)
        NameExpr(x)
        NameExpr(items))))
  AssignmentStmt:2(
    NameExpr(b)
    ListComprehension:2(
      GeneratorExpr:2(
        OpExpr:2(
          *
          NameExpr(x)
          IntExpr(2))
        NameExpr(x)
        CallExpr:2(
          NameExpr(range)
          Args(
            IntExpr(10)))
        ComparisonExpr:2(
          >
          NameExpr(x)
          IntExpr(5)))))
  AssignmentStmt:3(
    NameExpr(c)
    SetComprehension:3(
      GeneratorExpr:3(
        NameExpr(y)
        NameExpr(y)
        NameExpr(data))))
  AssignmentStmt:4(
    NameExpr(d)
    SetComprehension:4(
      GeneratorExpr:4(
        OpExpr:4(
          +
          NameExpr(z)
          IntExpr(1))
        NameExpr(z)
        NameExpr(nums)
        ComparisonExpr:4(
          <
          NameExpr(z)
          IntExpr(100))))))

[case testDictComprehensions]
a = {k: v for k, v in items}
b = {x: x * 2 for x in range(10) if x > 5}
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(a)
    DictionaryComprehension:1(
      NameExpr(k)
      NameExpr(v)
      TupleExpr:1(
        NameExpr(k)
        NameExpr(v))
      NameExpr(items)))
  AssignmentStmt:2(
    NameExpr(b)
    DictionaryComprehension:2(
      NameExpr(x)
      OpExpr:2(
        *
        NameExpr(x)
        IntExpr(2))
      NameExpr(x)
      CallExpr:2(
        NameExpr(range)
        Args(
          IntExpr(10)))
      ComparisonExpr:2(
        >
        NameExpr(x)
        IntExpr(5)))))

[case testDecoratedFuncDef]
@dec
def foo():
    pass
class C:    
    @dec()
    @staticmethod
    def foo():
        pass
[out]
MypyFile:1(
  Decorator:1(
    Var(foo)
    NameExpr(dec)
    FuncDef:2(
      foo
      Block:3(
        PassStmt:3())))
  ClassDef:4(
    C
    Decorator:5(
      Var(foo)
      CallExpr:5(
        NameExpr(dec)
        Args())
      NameExpr(staticmethod)
      FuncDef:7(
        foo
        Block:8(
          PassStmt:8())))))
[case testTryFinally]
try:
    x
finally:
    y
[out]
MypyFile:1(
  TryStmt:1(
    Block:2(
      ExpressionStmt:2(
        NameExpr(x)))
    Finally(
      ExpressionStmt:4(
        NameExpr(y)))))

[case testTryExcept]
try:
    x
except Exception:
    y
[out]
MypyFile:1(
  TryStmt:1(
    Block:2(
      ExpressionStmt:2(
        NameExpr(x)))
    NameExpr(Exception)
    Block:4(
      ExpressionStmt:4(
        NameExpr(y)))))

[case testTryExceptWithVar]
try:
    x
except Exception as e:
    y
[out]
MypyFile:1(
  TryStmt:1(
    Block:2(
      ExpressionStmt:2(
        NameExpr(x)))
    NameExpr(Exception)
    NameExpr(e)
    Block:4(
      ExpressionStmt:4(
        NameExpr(y)))))

[case testTryExceptElse]
try:
    x
except Exception:
    y
else:
    z
[out]
MypyFile:1(
  TryStmt:1(
    Block:2(
      ExpressionStmt:2(
        NameExpr(x)))
    NameExpr(Exception)
    Block:4(
      ExpressionStmt:4(
        NameExpr(y)))
    Else(
      ExpressionStmt:6(
        NameExpr(z)))))

[case testTryMultipleExcept]
try:
    x
except ValueError:
    y
except KeyError as e:
    z
[out]
MypyFile:1(
  TryStmt:1(
    Block:2(
      ExpressionStmt:2(
        NameExpr(x)))
    NameExpr(ValueError)
    Block:4(
      ExpressionStmt:4(
        NameExpr(y)))
    NameExpr(KeyError)
    NameExpr(e)
    Block:6(
      ExpressionStmt:6(
        NameExpr(z)))))

[case testConditionalExprSimple]
x if y else z
[out]
MypyFile:1(
  ExpressionStmt:1(
    ConditionalExpr:1(
      Condition(
        NameExpr(y))
      NameExpr(x)
      NameExpr(z))))

[case testFunctionWithCallableType]
def f(x: Callable[[int, str], None]) -> None:
    pass
[out]
MypyFile:1(
  FuncDef:1(
    f
    Args(
      Var(x))
    def (x: Callable?[<TypeList int?, str?>, None?]) -> None?
    Block:2(
      PassStmt:2())))

[case testFunctionWithEmptyCallableType]
def g(callback: Callable[[], bool]) -> int:
    return 1
[out]
MypyFile:1(
  FuncDef:1(
    g
    Args(
      Var(callback))
    def (callback: Callable?[<TypeList >, bool?]) -> int?
    Block:2(
      ReturnStmt:2(
        IntExpr(1)))))

[case testFunctionWithComplexCallableType]
def h(f: Callable[[List[int], Dict[str, int]], Tuple[int, str]]) -> None:
    pass
[out]
MypyFile:1(
  FuncDef:1(
    h
    Args(
      Var(f))
    def (f: Callable?[<TypeList List?[int?], Dict?[str?, int?]>, Tuple?[int?, str?]]) -> None?
    Block:2(
      PassStmt:2())))

[case testFunctionWithEllipsisCallableType]
def f(callback: Callable[..., int]) -> None:
    pass
[out]
MypyFile:1(
  FuncDef:1(
    f
    Args(
      Var(callback))
    def (callback: Callable?[..., int?]) -> None?
    Block:2(
      PassStmt:2())))

[case testLiteralTypes]
x: Literal[True, False]
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    TempNode:1(
      Any)
    Literal?[True, False]))

[case testDelStmt]
del x
del x[0], y[1]
del a.b
[out]
MypyFile:1(
  DelStmt:1(
    NameExpr(x))
  DelStmt:2(
    TupleExpr:2(
      IndexExpr:2(
        NameExpr(x)
        IntExpr(0))
      IndexExpr:2(
        NameExpr(y)
        IntExpr(1))))
  DelStmt:3(
    MemberExpr:3(
      NameExpr(a)
      b)))

[case testFString]
f"foo {x}"
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      MemberExpr:1(
        StrExpr()
        join)
      Args(
        ListExpr:1(
          StrExpr(foo )
          CallExpr:1(
            MemberExpr:1(
              StrExpr({:{}})
              format)
            Args(
              NameExpr(x)
              StrExpr())))))))

[case testFStringWithConversion]
x = 'mypy'
F'Hello {x!r}'
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    StrExpr(mypy))
  ExpressionStmt:2(
    CallExpr:2(
      MemberExpr:2(
        StrExpr()
        join)
      Args(
        ListExpr:2(
          StrExpr(Hello )
          CallExpr:2(
            MemberExpr:2(
              StrExpr({!r:{}})
              format)
            Args(
              NameExpr(x)
              StrExpr())))))))

[case testFStringTrivial]
f"foo"
f"{x}"
f"foo" "bar"
[out]
MypyFile:1(
  ExpressionStmt:1(
    StrExpr(foo))
  ExpressionStmt:2(
    CallExpr:2(
      MemberExpr:2(
        StrExpr({:{}})
        format)
      Args(
        NameExpr(x)
        StrExpr())))
  ExpressionStmt:3(
    StrExpr(foobar)))

[case testFStringWithOnlyFormatSpecifier]
x = 'mypy'
f'Hello {x:<30}'
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    StrExpr(mypy))
  ExpressionStmt:2(
    CallExpr:2(
      MemberExpr:2(
        StrExpr()
        join)
      Args(
        ListExpr:2(
          StrExpr(Hello )
          CallExpr:2(
            MemberExpr:2(
              StrExpr({:{}})
              format)
            Args(
              NameExpr(x)
              StrExpr(<30))))))))

[case testFStringWithFormatSpecifierExpression]
x = 'mypy'
y = 30
f'Hello {x!s:<{y+y}}'
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    StrExpr(mypy))
  AssignmentStmt:2(
    NameExpr(y)
    IntExpr(30))
  ExpressionStmt:3(
    CallExpr:3(
      MemberExpr:3(
        StrExpr()
        join)
      Args(
        ListExpr:3(
          StrExpr(Hello )
          CallExpr:3(
            MemberExpr:3(
              StrExpr({!s:{}})
              format)
            Args(
              NameExpr(x)
              CallExpr:3(
                MemberExpr:3(
                  StrExpr()
                  join)
                Args(
                  ListExpr:3(
                    StrExpr(<)
                    CallExpr:3(
                      MemberExpr:3(
                        StrExpr({:{}})
                        format)
                      Args(
                        OpExpr:3(
                          +
                          NameExpr(y)
                          NameExpr(y))
                        StrExpr()))))))))))))

[case testSimpleLambda]
lambda: 1
[out]
MypyFile:1(
  ExpressionStmt:1(
    LambdaExpr:1(
      Block:1(
        ReturnStmt:1(
          IntExpr(1))))))

[case testLambdaWithOneArg]
lambda x: y + 1
[out]
MypyFile:1(
  ExpressionStmt:1(
    LambdaExpr:1(
      Args(
        Var(x))
      Block:1(
        ReturnStmt:1(
          OpExpr:1(
            +
            NameExpr(y)
            IntExpr(1)))))))

[case testLambdaWithMultipleArgs]
lambda x, y: x + y
[out]
MypyFile:1(
  ExpressionStmt:1(
    LambdaExpr:1(
      Args(
        Var(x)
        Var(y))
      Block:1(
        ReturnStmt:1(
          OpExpr:1(
            +
            NameExpr(x)
            NameExpr(y)))))))

[case testLambdaWithDefault]
lambda x=2: x
[out]
MypyFile:1(
  ExpressionStmt:1(
    LambdaExpr:1(
      Args(
        default(
          Var(x)
          IntExpr(2)))
      Block:1(
        ReturnStmt:1(
          NameExpr(x))))))

[case testLambdaInCall]
map(lambda x: x * 2, items)
[out]
MypyFile:1(
  ExpressionStmt:1(
    CallExpr:1(
      NameExpr(map)
      Args(
        LambdaExpr:1(
          Args(
            Var(x))
          Block:1(
            ReturnStmt:1(
              OpExpr:1(
                *
                NameExpr(x)
                IntExpr(2)))))
        NameExpr(items)))))

[case testNamedExprSimple]
if (x := 1):
    pass
[out]
MypyFile:1(
  IfStmt:1(
    If(
      AssignmentExpr:1(
        NameExpr(x)
        IntExpr(1)))
    Then(
      PassStmt:2())))

[case testStarExpression]
*a
*a, b
a, *b
[out]
MypyFile:1(
  ExpressionStmt:1(
    StarExpr:1(
      NameExpr(a)))
  ExpressionStmt:2(
    TupleExpr:2(
      StarExpr:2(
        NameExpr(a))
      NameExpr(b)))
  ExpressionStmt:3(
    TupleExpr:3(
      NameExpr(a)
      StarExpr:3(
        NameExpr(b)))))

[case testBytesLiteral]
b"foo"
b"foobar"
b"x\\n\\'"
[out]
MypyFile:1(
  ExpressionStmt:1(
    BytesExpr(foo))
  ExpressionStmt:2(
    BytesExpr(foobar))
  ExpressionStmt:3(
    BytesExpr(x\\n\\\')))

[case testBytesLiteralWithEscapes]
b'\r\n\t\x2f\xbe'
[out]
MypyFile:1(
  ExpressionStmt:1(
    BytesExpr(\r\n\t/\xbe)))

[case testBytesLiteralOctalEscapes]
b'\1\476'
[out]
MypyFile:1(
  ExpressionStmt:1(
    BytesExpr(\x01>)))
[case testGlobalAndNonlocal]
x = 1
y = 2
def outer():
    global x
    def inner():
        nonlocal y
        global z
        y = 3
        z = 4
    x = 5
[out]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    IntExpr(1))
  AssignmentStmt:2(
    NameExpr(y)
    IntExpr(2))
  FuncDef:3(
    outer
    Block:4(
      GlobalDecl:4(
        x)
      FuncDef:5(
        inner
        Block:6(
          NonlocalDecl:6(
            y)
          GlobalDecl:7(
            z)
          AssignmentStmt:8(
            NameExpr(y)
            IntExpr(3))
          AssignmentStmt:9(
            NameExpr(z)
            IntExpr(4))))
      AssignmentStmt:10(
        NameExpr(x)
        IntExpr(5)))))
[case testAwaitExpression]
async def foo():
    x = await bar()
    return await baz(x)
[out]
MypyFile:1(
  FuncDef:1(
    foo
    Async
    Block:2(
      AssignmentStmt:2(
        NameExpr(x)
        AwaitExpr:2(
          CallExpr:2(
            NameExpr(bar)
            Args())))
      ReturnStmt:3(
        AwaitExpr:3(
          CallExpr:3(
            NameExpr(baz)
            Args(
              NameExpr(x))))))))

[case testSyntaxError]
x = [1 2]
y = 2
[out]
1:8: error: Expected ',', found int
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    ListExpr:1(
      IntExpr(1)
      IntExpr(2)))
  AssignmentStmt:2(
    NameExpr(y)
    IntExpr(2)))

[case testFunctionOverload]
@overload
def f() -> x: pass
@overload
def f() -> y: pass
[out]
MypyFile:1(
  OverloadedFuncDef:1(
    Decorator:1(
      Var(f)
      NameExpr(overload)
      FuncDef:2(
        f
        def () -> x?
        Block:2(
          PassStmt:2())))
    Decorator:3(
      Var(f)
      NameExpr(overload)
      FuncDef:4(
        f
        def () -> y?
        Block:4(
          PassStmt:4())))))

[case testFunctionOverloadWithImplementation]
@overload
def f(a: x) -> x: ...
@overload
def f(a: y) -> y: ...
def f(a): pass
[out]
MypyFile:1(
  OverloadedFuncDef:1(
    Decorator:1(
      Var(f)
      NameExpr(overload)
      FuncDef:2(
        f
        Args(
          Var(a))
        def (a: x?) -> x?
        Block:2(
          ExpressionStmt:2(
            Ellipsis))))
    Decorator:3(
      Var(f)
      NameExpr(overload)
      FuncDef:4(
        f
        Args(
          Var(a))
        def (a: y?) -> y?
        Block:4(
          ExpressionStmt:4(
            Ellipsis))))
    FuncDef:5(
      f
      Args(
        Var(a))
      Block:5(
        PassStmt:5()))))

[case testTypeIgnores]
x = 1  # type: ignore
y = (
   2  # type: ignore  # Comment
)
y = 1 # foo: ignore
z = 1  #type: ignore[x]
zz = 1  #type: ignore [ foo, arg-type ]
[out]
ignore: 1
ignore: 3
ignore: 6 [x]
ignore: 7 [foo, arg-type]
MypyFile:1(
  AssignmentStmt:1(
    NameExpr(x)
    IntExpr(1))
  AssignmentStmt:2(
    NameExpr(y)
    IntExpr(2))
  AssignmentStmt:5(
    NameExpr(y)
    IntExpr(1))
  AssignmentStmt:6(
    NameExpr(z)
    IntExpr(1))
  AssignmentStmt:7(
    NameExpr(zz)
    IntExpr(1)))
